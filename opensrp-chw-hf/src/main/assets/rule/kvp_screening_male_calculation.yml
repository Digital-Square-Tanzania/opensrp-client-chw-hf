---
name: step1_is_pwud
description: check if client falls in pwud
priority: 1
condition: "true"
actions:
  - "calculation = step1_drug_use.equals('yes') ? 'yes' : 'no'"
---
name: step2_is_pwid
description: check if client falls in pwid
priority: 1
condition: "true"
actions:
  - "calculation = step2_drug_injection.equals('yes') ? 'yes' : 'no'"
---
name: step4_is_msm
description: check if client falls in msm
priority: 1
condition: "true"
actions:
  - "calculation = (step4_sexual_intercourse_with.equals('man') || step4_sexual_intercourse_with.equals('both')) ? 'yes' : 'no' "
---
name: step5_is_sdc
description: check if client falls in sdc
priority: 1
condition: "true"
actions:
  - "calculation = (step5_hiv_status_on_screening.equals('negative') && step5_hiv_positive_partner.equals('yes')) ? 'yes' : 'no' "
---
name: step6_is_prisoner
description: check if client is prisoner
priority: 1
condition: "true"
actions:
  - "calculation = step6_prisoner_or_rumandee.contains('prisoner') ? 'yes' : 'no' "
---
name: step6_is_rumandee
description: check if client is rumandee
priority: 1
condition: "true"
actions:
  - "calculation = step6_prisoner_or_rumandee.contains('rumandee') ? 'yes' : 'no' "
---
name: step6_is_mobile_population
description: check if client is a mobile population
priority: 1
condition: "true"
actions:
  - "calculation = !step6_mobile_population.equals('none') ? 'yes' : 'no' "
---
name: step6_is_ovp_kvp
description: check if client falls in other groups at risk of hiv infection
priority: 1
condition: "true"
actions:
  - "calculation = !step6_other_groups_at_risk.equals('none') ? 'yes' : 'no' "
---
name: step7_should_enroll
description: check if should enroll client if they belong to any kvp group
priority: 1
condition: "true"
actions:
  - "calculation = (step1_is_pwud.equals('yes') || step2_is_pwid.equals('yes') || step4_is_msm.equals('yes') || step5_is_sdc.equals('yes') || step6_is_prisoner.equals('yes')  || step6_is_rumandee.equals('yes') || step6_is_mobile_population.equals('yes') || step6_is_ovp_kvp.equals('yes')) ? 'yes' : 'no' "
---
name: step8_other_screened_client_group
description: other KVP Groups Calculation
priority: 1
condition: "true"
actions:
  - "def getOtherKvpGroups(pwud,pwid,sdc,msm,prisoner,rumandee,mobile_population,ovp) {
        String otherGroups = '';
               
        if(pwud.contains('yes')){
          otherGroups+='pwud,';
        }
        
        
        if(pwid.equals('yes')){
           otherGroups+='pwid,';
        }
        
        if(sdc.equals('yes')){
          otherGroups+='sdc,';
        }
        
        if(msm.equals('yes')){
          otherGroups+='msm,';
        }
        
        if(prisoner.equals('yes')){
          otherGroups+='prisoner,';
        }
        
        if(rumandee.equals('yes')){
          otherGroups+='rumandee,';
        }
        
        if(mobile_population.equals('yes')){
          otherGroups+='mobile_population,';
        }
     
        if(ovp.equals('yes')){
          otherGroups+='other_vulnerable_population,';
        }
        
        if (otherGroups != null && otherGroups.length() > 0 && otherGroups.charAt(otherGroups.length() - 1) == ',') {
          String modified = otherGroups.substring(0, otherGroups.length() - 1);
          return modified;
        }
        return otherGroups;
               
     }"
  - "calculation = '['+getOtherKvpGroups(step1_is_pwud, step2_is_pwid, step5_is_sdc, step4_is_msm, step6_is_prisoner,step6_is_rumandee, step6_is_mobile_population, step6_is_ovp_kvp)+']'"


